<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Genesys Headless Test</title>
</head>
<body>
  <h1>Genesys Headless Chat - Minimal Test</h1>
  <button id="startBtn" onclick="resetAndConfigure()" disabled>Start or Resume Conversation</button>

  <script>
    // Debug logging to verify script runs
    console.log("üì¢ Script loaded");

    // Inject Genesys SDK
    (function (g, e, n, es) {
      g["_genesysJs"] = e;
      g[e] = g[e] || function () { (g[e].q = g[e].q || []).push(arguments); };
      g[e].t = +new Date();
      g[e].c = es;
      var s = document.createElement("script");
      s.async = true;
      s.src = n;
      s.charset = "utf-8";
      document.head.appendChild(s);
    })(
      window,
      "Genesys",
      "https://apps.cac1.pure.cloud/genesys-bootstrap/genesys.min.js",
      {
        deploymentId: "52f242c7-8771-4368-b20b-2929a715fedb", // your real deploymentId
        environment: "cac1",
        messenger: { headlessMode: true },
        debug: true
      }
    );

    // Subscribe to lifecycle events
    Genesys("subscribe", "MessagingService.ready", function () {
      console.log("‚úÖ MessagingService.ready");
      document.getElementById("startBtn").disabled = false;
    });

    Genesys("subscribe", "MessagingService.error", function (e) {
      console.error("‚ùå MessagingService error:", e);
    });

    function resetAndConfigure() {
      console.log("üîÑ Starting config flow‚Ä¶");

      Genesys("command", "MessagingService.clearConversation", {}, function () {
        Genesys("command", "MessagingService.configureConversation", {}, function (resp) {
          console.log("‚úÖ Conversation configured:", resp);
        }, function (err) {
          console.error("‚ùå configureConversation error:", err);
        });
      }, function (err) {
        console.error("‚ùå clearConversation error:", err);
      });
    }

    // Expose to global scope
    window.resetAndConfigure = resetAndConfigure;
  </script>
</body>
</html>
